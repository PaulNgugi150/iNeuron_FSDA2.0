/*SALES_FINAL_DATA*/

USE WAREHOUSE DEMOWAREHOUSE;
USE DATABASE DEMODATABASE;
USE SCHEMA PUBLIC;
CREATE OR REPLACE TABLE PN_SALES_FINAL_DATA
(ORDER_ID STRING,
  ORDER_DATE DATE,
  SHIP_DATE DATE,
  SHIP_MODE VARCHAR(20),
 CUSTOMER_NAME VARCHAR(40),
 SEGMENT VARCHAR(15),
 STATE VARCHAR(40),
 COUNTRY VARCHAR(25),
 MARKET VARCHAR(10),
 REGION VARCHAR(20),
 PRODUCT_ID VARCHAR(40),
 CATEGORY VARCHAR(20),
 SUB_CATEGORY VARCHAR(20),
 PRODUCT_NAME STRING,
 SALES INT,
 QUANTITY INT,
 DISCOUNT FLOAT,
 PROFIT NUMBER(10,5),
 SHIPPING_COST FLOAT,
 ORDER_PRIORITY VARCHAR(10),
 YEAR_OF INT NOT NULL PRIMARY KEY
 );
 DESCRIBE TABLE PN_SALES_FINAL_DATA;
 SELECT * FROM PN_SALES_FINAL_DATA;
SELECT DISTINCT DISCOUNT FROM PN_SALES_FINAL_DATA;
SELECT column_name, data_type FROM information_schema.columns
WHERE table_schema='PUBLIC' AND table_name='PN_SALES_FINAL_DATA' AND column_name in ('ORDER_DATE','SHIP_DATE');
 

 ---ADD PRIMARY KEY TO COLUMN (ORDER ID)
 ALTER TABLE PN_SALES_FINAL_DATA
 DROP PRIMARY KEY;
 ALTER TABLE PN_SALES_FINAL_DATA
 ADD PRIMARY KEY(ORDER_ID);
 
 DESCRIBE TABLE PN_SALES_FINAL_DATA;
SELECT * FROM PN_SALES_FINAL_DATA;

/*---CHECK THE DATA TYPE FOR ORDER DATE AND SHIP DATE
AND MENTION IN WHAT DATA TYPE IT SHOULD BE
*/

SELECT column_name, data_type FROM information_schema.columns
WHERE table_schema='PUBLIC' AND table_name='PN_SALES_FINAL_DATA' AND column_name in ('ORDER_DATE','SHIP_DATE');
---CREATE A NEW COLUMN CALLED ORDER_EXTRACT AND EXTRACT THE NUMBER AFTER THE LAST '-' FROM ORDER ID COLUMN
SELECT ORDER_ID,SUBSTRING(ORDER_ID,9,10)AS ORDER_EXTRACT FROM PN_SALES_FINAL_DATA;

/*---CREATE A NEW COLUMN CALLLED DISCOUNT FLAG AND CATEGORIZE IT BASED 
ON DISCOUNT.USE 'YES ' IF THE DISCOUNT IS GREATER THAN ZERO ELSE 'NO'.*/
SELECT *,
   CASE WHEN DISCOUNT >0 THEN 'YES'
   ELSE 'NO'
   END AS DSICOUNT_FLAG
FROM PN_SALES_FINAL_DATA;
SELECT DISTINCT DISCOUNT FROM  PN_SALES_FINAL_DATA;

/*----CREATE A NEW COLUMN CALLED PROCESS DAYS AND CALCUALTE HOW MANY
DAYS IT TAKES FOR EACH ORDER ID TO PROCESS FROM THE ORDER OF ITS SHIPMENT*/
SELECT *,
  DATEDIFF('DAYS',ORDER_DATE,SHIP_DATE) AS PROCESS_DAYS
FROM PN_SALES_FINAL_DATA;

SELECT * FROM PN_SALES_FINAL_DATA;



/*____CREATE A NEW COLUMN CALLED RATING AND THEN BASED ON 
THE PROCESS DATES GIVE RATING*/
SELECT *,
  DATEDIFF('DAYS',ORDER_DATE,SHIP_DATE) AS PROCESS_DAYS,
  CASE 
    WHEN DATEDIFF('DAYS',ORDER_DATE,SHIP_DATE) <= 3 THEN 5
    WHEN DATEDIFF('DAYS',ORDER_DATE,SHIP_DATE) > 3 and DATEDIFF('DAYS',ORDER_DATE,SHIP_DATE) <= 6 THEN 4
    WHEN DATEDIFF('DAYS',ORDER_DATE,SHIP_DATE) > 6 and DATEDIFF('DAYS',ORDER_DATE,SHIP_DATE) <= 10 THEN 3
    ELSE 2
  END as RATING
FROM PN_SALES_FINAL_DATA;






